<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Welcome to PESO Job Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body { background-color: #f0f2f5; }
        .login-container { min-height: 100vh; display: flex; align-items: center; }
        .login-card { border: none; border-radius: 1rem; box-shadow: 0 0.5rem 1rem 0 rgba(0, 0, 0, 0.1); }
        .login-card .card-body { padding: 2rem; }
        .nav-pills .nav-link.active { background-color: #004080; }
        .nav-pills .nav-link { color: #004080; }
        .featured-job-card { border-left: 4px solid #004080; }
    </style>
</head>
<body>
    <div class="container login-container">
        <div class="row w-100 justify-content-center">
            <div class="col-lg-10 col-xl-9">
                <div class="card login-card">
                    <div class="card-body p-4 p-md-5">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="text-center mb-4">
                                    <i class="fas fa-building fa-3x" style="color: #004080;" aria-hidden="true"></i>
                                    <h3 class="mt-2">PESO Job Portal</h3>
                                    <p class="text-muted">Connecting Valenzuelanos to Opportunities</p>
                                </div>
                                <div id="login-alert-placeholder" aria-live="polite" aria-atomic="true"></div>
                                <form id="loginForm">
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email address</label>
                                        <input type="email" class="form-control" id="email" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="password" class="form-label">Password</label>
                                        <input type="password" class="form-control" id="password" required>
                                    </div>
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="rememberMe">
                                        <label class="form-check-label" for="rememberMe">Remember Me</label>
                                    </div>
                                    <div class="d-grid">
                                        <button class="btn btn-primary btn-lg" type="submit">Login</button>
                                    </div>
                                    <div class="text-center mt-3">
                                        <a href="#" class="small">Forgot Password?</a> | 
                                        <!-- REVISED: Updated link to go to register.html -->
                                        <a href="register.html" class="small">Create an Account</a>
                                    </div>
                                </form>
                            </div>
                            <div class="col-md-6 bg-light p-4 rounded-end">
                                <h5><i class="fas fa-fire me-2" aria-hidden="true"></i>Urgent Hiring</h5>
                                <div id="featured-jobs-list">
                                    <p class="text-muted">Loading featured jobs...</p>
                                </div>
                                <hr>
                                <h5><i class="fas fa-bullhorn me-2" aria-hidden="true"></i>Contact Us</h5>
                                <p class="small mb-1"><strong>Hotline:</strong> (02) 8-123-4567</p>
                                <p class="small"><strong>Email:</strong> peso@valenzuela.gov.ph</p>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <!-- Reminders section (no changes) -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="shared.js"></script>
    <script>
        // All JavaScript is correct and does not need changes.
        document.addEventListener('DOMContentLoaded', () => {
            if (getLoggedInUser()) {
                redirectToDashboard(getLoggedInUser().role);
            }
            loadFeaturedJobs();
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
        });

        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            const alertPlaceholder = document.getElementById('login-alert-placeholder');
            const users = getData('users');
            const foundUser = users.find(user => user.email === email && user.password === password);
            if (foundUser) {
                setLoggedInUser(foundUser, rememberMe);
                redirectToDashboard(foundUser.role);
            } else {
                alertPlaceholder.innerHTML = `<div class="alert alert-danger" role="alert">Invalid email or password. Please try again.</div>`;
            }
        }

        function redirectToDashboard(role) {
            const routes = {
                [USER_ROLES.APPLICANT]: 'applicant.html',
                [USER_ROLES.EMPLOYER]: 'employer.html',
                [USER_ROLES.ADMIN]: 'peso-admin.html'
            };
            if (routes[role]) {
                window.location.href = routes[role];
            } else {
                console.error("Unknown user role:", role);
                document.getElementById('login-alert-placeholder').innerHTML = `<div class="alert alert-danger">Could not redirect user with unknown role.</div>`;
            }
        }

        function loadFeaturedJobs() {
            const container = document.getElementById('featured-jobs-list');
            const featuredJobs = getData('jobs').filter(j => j.status === 'approved' && j.isOpen).slice(0, 3);
            if (featuredJobs.length > 0) {
                let content = '';
                featuredJobs.forEach(job => {
                    const employer = getData('users').find(u => u.id === job.employerId);
                    content += `<div class="card mb-2 featured-job-card"><div class="card-body py-2 px-3">
                                <h6 class="card-title mb-0">${job.title}</h6>
                                <p class="card-text small text-muted">${employer ? employer.profile.companyName : 'Unknown Company'}</p>
                            </div></div>`;
                });
                container.innerHTML = content;
            } else {
                container.innerHTML = '<p class="text-muted small">No urgent hiring posts at the moment. Please log in to see all available jobs.</p>';
            }
        }
    </script>
</body>
</html>